# Menentukan versi syntax Docker Compose yang digunakan
version: '3.8'

# Mendefinisikan semua layanan (container) yang akan dijalankan
services:

  # Layanan untuk antarmuka voting (frontend)
  vote:
    # Membangun image dari Dockerfile di dalam folder ./vote
    build: ./vote
    # Memetakan port 5000 di komputer Anda ke port 80 di dalam container
    ports:
      - "5000:80"
    # Menghubungkan layanan ini ke jaringan 'vote-net'
    networks:
      - vote-net

  # Layanan untuk database Redis (antrian pesan)
  redis:
    # Menggunakan image Redis resmi yang ringan
    image: redis:alpine
    networks:
      - vote-net

  # Layanan worker (backend) yang memproses vote
  worker:
    # Membangun image dari Dockerfile di dalam folder ./worker
    build: ./worker
    # Menghubungkan ke jaringan yang sama
    networks:
      - vote-net

  # Layanan untuk database PostgreSQL (penyimpanan data)
  db:
    # Menggunakan image PostgreSQL versi 9.4
    image: postgres:9.4
    # Menyimpan data database secara permanen di volume 'db-data'
    volumes:
      - "db-data:/var/lib/postgresql/data"
    # Pengaturan environment untuk koneksi yang lebih mudah (hanya untuk development)
    environment:
      POSTGRES_HOST_AUTH_METHOD: trust
    networks:
      - vote-net

  # Layanan untuk menampilkan hasil voting
  result:
    # Membangun image dari Dockerfile di dalam folder ./result
    build: ./result
    ports:
      - "5001:80"
    networks:
      - vote-net

# Mendefinisikan jaringan agar semua container bisa saling berkomunikasi
networks:
  vote-net:

# Mendefinisikan volume untuk penyimpanan data persisten
volumes:
  db-data: